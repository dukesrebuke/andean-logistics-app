<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST - Live Tracking Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0e1a;
            color: #e2e8f0;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #00d9ff;
        }

        .test-badge {
            display: inline-block;
            background: #f59e0b;
            color: #0a0e1a;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 700;
            margin-bottom: 2rem;
        }

        .legend {
            background: #1a2032;
            border: 1px solid #1e293b;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        #map {
            height: 600px;
            border-radius: 8px;
            border: 1px solid #1e293b;
        }

        .status {
            margin-top: 1rem;
            padding: 1rem;
            background: #1a2032;
            border: 1px solid #1e293b;
            border-radius: 8px;
        }

        .status-item {
            margin-bottom: 0.5rem;
        }

        .status-item strong {
            color: #00d9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-badge">ðŸ§ª TEST FILE - Safe to experiment</div>
        <h1>Live Tracking Map Test</h1>
        <p style="color: #94a3b8; margin-bottom: 1rem;">
            Trucks should appear on the map and move along their routes every 3 seconds.
        </p>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-dot" style="background: #10b981;"></div>
                <span>In Transit (Green)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: #f59e0b;"></div>
                <span>Pending (Orange)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: #06b6d4;"></div>
                <span>Origin (Cyan)</span>
            </div>
            <div class="legend-item">
                <div class="legend-dot" style="background: #00d9ff;"></div>
                <span>Destination (Light Blue)</span>
            </div>
        </div>

        <div id="map"></div>

        <div class="status">
            <div class="status-item"><strong>Map Status:</strong> <span id="mapStatus">Loading...</span></div>
            <div class="status-item"><strong>Trucks Loaded:</strong> <span id="truckCount">0</span></div>
            <div class="status-item"><strong>Last Update:</strong> <span id="lastUpdate">Never</span></div>
        </div>
    </div>

    <script>
        let map = null;
        let markers = {};
        
        const loads = [
            {
                id: 'LD-2847',
                status: 'in-transit',
                origin: 'Dallas, TX',
                destination: 'Denver, CO',
                driver: 'Mike Rodriguez',
                currentLat: 36.7,
                currentLng: -101.5,
                originCoords: [32.7767, -96.7970],
                destCoords: [39.7392, -104.9903],
                progress: 0.45
            },
            {
                id: 'LD-2851',
                status: 'in-transit',
                origin: 'Atlanta, GA',
                destination: 'Miami, FL',
                driver: 'Sarah Chen',
                currentLat: 30.5,
                currentLng: -83.8,
                originCoords: [33.7490, -84.3880],
                destCoords: [25.7617, -80.1918],
                progress: 0.35
            },
            {
                id: 'LD-2856',
                status: 'in-transit',
                origin: 'Seattle, WA',
                destination: 'Portland, OR',
                driver: 'James Wilson',
                currentLat: 46.8,
                currentLng: -122.3,
                originCoords: [47.6062, -122.3321],
                destCoords: [45.5152, -122.6784],
                progress: 0.65
            },
            {
                id: 'LD-2859',
                status: 'in-transit',
                origin: 'Chicago, IL',
                destination: 'Detroit, MI',
                driver: 'Maria Garcia',
                currentLat: 42.1,
                currentLng: -85.2,
                originCoords: [41.8781, -87.6298],
                destCoords: [42.3314, -83.0458],
                progress: 0.55
            }
        ];

        function initMap() {
            try {
                document.getElementById('mapStatus').textContent = 'Initializing...';
                
                map = L.map('map', {
                    worldCopyJump: false,
                    maxBounds: [[-90, -180], [90, 180]],
                    maxBoundsViscosity: 1.0
                }).setView([39.8283, -98.5795], 4);
                
                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: 'Â© OpenStreetMap Â© CARTO',
                    maxZoom: 19,
                    noWrap: true
                }).addTo(map);
                
                loads.forEach(load => {
                    addTruckMarker(load);
                });
                
                document.getElementById('mapStatus').textContent = 'Running âœ“';
                document.getElementById('truckCount').textContent = loads.length;
                
                setInterval(animateTrucks, 3000);
                
            } catch (error) {
                document.getElementById('mapStatus').textContent = 'Error: ' + error.message;
                console.error('Map initialization error:', error);
            }
        }

        function addTruckMarker(load) {
            const markerColor = load.status === 'in-transit' ? '#10b981' : '#f59e0b';
            
            const truckIcon = L.divIcon({
                className: 'truck-marker',
                html: `<div style="
                    background: ${markerColor};
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    border: 3px solid #0a0e1a;
                    box-shadow: 0 0 10px rgba(0, 217, 255, 0.5);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 12px;
                    color: white;
                    font-weight: bold;
                ">ðŸš›</div>`,
                iconSize: [24, 24],
                iconAnchor: [12, 12]
            });
            
            const marker = L.marker([load.currentLat, load.currentLng], {
                icon: truckIcon
            }).addTo(map);
            
            marker.bindPopup(`
                <div style="color: #1a2032; font-family: Arial, sans-serif;">
                    <strong style="font-size: 1.1em; color: #00d9ff;">${load.id}</strong><br>
                    <strong>Driver:</strong> ${load.driver}<br>
                    <strong>Route:</strong> ${load.origin} â†’ ${load.destination}<br>
                    <strong>Status:</strong> ${load.status}
                </div>
            `);
            
            const routeLine = L.polyline([load.originCoords, load.destCoords], {
                color: '#0ea5e9',
                weight: 2,
                opacity: 0.5,
                dashArray: '10, 10'
            }).addTo(map);
            
            L.circleMarker(load.originCoords, {
                radius: 6,
                fillColor: '#06b6d4',
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map).bindPopup(`<strong>Origin:</strong> ${load.origin}`);
            
            L.circleMarker(load.destCoords, {
                radius: 6,
                fillColor: '#00d9ff',
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map).bindPopup(`<strong>Destination:</strong> ${load.destination}`);
            
            markers[load.id] = { marker, routeLine };
        }

        function animateTrucks() {
            loads.forEach(load => {
                if (load.status === 'in-transit' && markers[load.id]) {
                    const origin = load.originCoords;
                    const dest = load.destCoords;
                    
                    load.progress += 0.02;
                    if (load.progress > 1) load.progress = 0.05; // Loop back
                    
                    const newLat = origin[0] + (dest[0] - origin[0]) * load.progress;
                    const newLng = origin[1] + (dest[1] - origin[1]) * load.progress;
                    
                    markers[load.id].marker.setLatLng([newLat, newLng]);
                    
                    load.currentLat = newLat;
                    load.currentLng = newLng;
                }
            });
            
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }

        // Wait for page to load
        window.addEventListener('load', () => {
            // Check if Leaflet is loaded
            function checkLeaflet() {
                if (typeof L !== 'undefined') {
                    initMap();
                } else {
                    document.getElementById('mapStatus').textContent = 'Waiting for Leaflet to load...';
                    setTimeout(checkLeaflet, 100);
                }
            }
            checkLeaflet();
        });
    </script>
</body>
</html>